pipeline{
    agent any
    // to get the env variables use https://jenkins_url/env-vars/html
    // set environment variable can be used throughout this jenkinsfile
    environment {
        BUILD_NAME = "ganesh_test"
        GIT_KEY = credentials("github_ssh")
        TEST_PASS = credentials("test")
    }
    stages{
        stage("build"){
            // when condition to run this stage("build")
            when {
                expression {
                    BRANCH_NAME == "main"
                }
            }
            // steps for the stages to build
            steps{
                echo "Building docker container"
                echo "tagging docker image"
                echo "Current branch name is the ${BRANCH_NAME}" 
                echo "build name: ${BUILD_NAME}"
                echo "${GIT_KEY}"
                echo "${TEST_PASS}"
            }
        }
        stage("test"){
            when {
                expression {
                    // || refers to `or` condition && refers to `and` condition
                    BRANCH_NAME == "dev" || BRANCH_NAME == "test"
                }
            }
            steps{
                echo "testing the application"
            }
        }
    }
    post{
        always{
            echo "build completed"
        }
        success{
            echo "build success"
        }
        failure{
            echo "build failed"
        }
    }
}